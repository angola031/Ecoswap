#!/usr/bin/env node

/**
 * Script para diagnosticar errores de autenticaci√≥n de Supabase
 */

console.log('üîç Diagnosticando errores de autenticaci√≥n de Supabase...\n')

console.log('üìã ERRORES IDENTIFICADOS:')
console.log('   ‚ùå /auth/v1/verify')
console.log('   ‚ùå POST /auth/v1/token')
console.log('   ‚ùå GET /auth/v1/verify')
console.log('')

console.log('üîß CAUSAS COMUNES Y SOLUCIONES:')
console.log('')

console.log('1. üö® SITE URL INCORRECTA EN SUPABASE:')
console.log('   Problema: Site URL configurada como localhost')
console.log('   Soluci√≥n:')
console.log('   - Ve a Supabase Dashboard ‚Üí Authentication ‚Üí URL Configuration')
console.log('   - Site URL: https://ecoswap-lilac.vercel.app')
console.log('   - Redirect URLs: https://ecoswap-lilac.vercel.app/auth/callback')
console.log('')

console.log('2. üö® REDIRECT URLs NO CONFIGURADAS:')
console.log('   Problema: Supabase no reconoce las URLs de redirecci√≥n')
console.log('   Soluci√≥n:')
console.log('   - Agregar a Redirect URLs:')
console.log('     * https://ecoswap-lilac.vercel.app/auth/callback')
console.log('     * https://ecoswap-lilac.vercel.app/auth/callback?next=/auth/reset-password')
console.log('     * https://ecoswap-lilac.vercel.app/auth/reset-password')
console.log('')

console.log('3. üö® CONFIGURACI√ìN DE EMAIL INCORRECTA:')
console.log('   Problema: Plantillas de email mal configuradas')
console.log('   Soluci√≥n:')
console.log('   - Ve a Authentication ‚Üí Email Templates')
console.log('   - Reset Password template debe usar {{ .ConfirmationURL }}')
console.log('   - Verificar que la URL base sea correcta')
console.log('')

console.log('4. üö® VARIABLES DE ENTORNO INCORRECTAS:')
console.log('   Problema: NEXT_PUBLIC_SUPABASE_URL o NEXT_PUBLIC_SUPABASE_ANON_KEY incorrectas')
console.log('   Soluci√≥n:')
console.log('   - Verificar en Vercel Dashboard ‚Üí Settings ‚Üí Environment Variables')
console.log('   - NEXT_PUBLIC_SUPABASE_URL debe ser: https://vaqdzualcteljmivtoka.supabase.co')
console.log('   - NEXT_PUBLIC_SUPABASE_ANON_KEY debe ser la clave an√≥nima correcta')
console.log('')

console.log('üß™ PASOS PARA SOLUCIONAR:')
console.log('')

console.log('PASO 1: Verificar Supabase Dashboard')
console.log('   1. Ve a https://supabase.com/dashboard')
console.log('   2. Selecciona tu proyecto')
console.log('   3. Ve a Settings ‚Üí Authentication')
console.log('   4. Verifica URL Configuration:')
console.log('      - Site URL: https://ecoswap-lilac.vercel.app')
console.log('      - Redirect URLs: https://ecoswap-lilac.vercel.app/auth/callback')
console.log('')

console.log('PASO 2: Verificar Email Templates')
console.log('   1. Ve a Authentication ‚Üí Email Templates')
console.log('   2. Selecciona "Reset Password"')
console.log('   3. Verifica que use {{ .ConfirmationURL }}')
console.log('   4. Guarda los cambios')
console.log('')

console.log('PASO 3: Verificar Variables de Entorno en Vercel')
console.log('   1. Ve a Vercel Dashboard ‚Üí tu proyecto')
console.log('   2. Settings ‚Üí Environment Variables')
console.log('   3. Verifica:')
console.log('      - NEXT_PUBLIC_SUPABASE_URL')
console.log('      - NEXT_PUBLIC_SUPABASE_ANON_KEY')
console.log('   4. Si est√°n mal, corr√≠gelas y haz redeploy')
console.log('')

console.log('PASO 4: Probar nuevamente')
console.log('   1. Espera 2-3 minutos despu√©s de los cambios')
console.log('   2. Ve a https://ecoswap-lilac.vercel.app/login')
console.log('   3. Prueba el restablecimiento de contrase√±a')
console.log('   4. Revisa los logs en la consola del navegador')
console.log('')

console.log('üö® CONFIGURACI√ìN ESPEC√çFICA PARA TU PROYECTO:')
console.log('')

console.log('Supabase Dashboard ‚Üí Authentication ‚Üí URL Configuration:')
console.log('   Site URL: https://ecoswap-lilac.vercel.app')
console.log('   Redirect URLs:')
console.log('     - https://ecoswap-lilac.vercel.app/auth/callback')
console.log('     - https://ecoswap-lilac.vercel.app/auth/callback?next=/auth/reset-password')
console.log('     - https://ecoswap-lilac.vercel.app/auth/reset-password')
console.log('     - https://ecoswap-lilac.vercel.app/**')
console.log('')

console.log('Vercel Dashboard ‚Üí Environment Variables:')
console.log('   NEXT_PUBLIC_SUPABASE_URL: https://vaqdzualcteljmivtoka.supabase.co')
console.log('   NEXT_PUBLIC_SUPABASE_ANON_KEY: [tu clave an√≥nima]')
console.log('   NEXT_PUBLIC_SITE_URL: https://ecoswap-lilac.vercel.app')
console.log('')

console.log('üìû SI SIGUES TENIENDO PROBLEMAS:')
console.log('   1. Comparte una captura de pantalla de la configuraci√≥n de Supabase')
console.log('   2. Verifica que las variables de entorno est√©n correctas en Vercel')
console.log('   3. Revisa los logs de Supabase Dashboard ‚Üí Logs')
console.log('   4. Aseg√∫rate de que el proyecto est√© desplegado correctamente')
console.log('')

console.log('üéØ RESUMEN:')
console.log('   - Los errores /auth/v1/verify indican configuraci√≥n incorrecta')
console.log('   - Principalmente es problema de Site URL en Supabase')
console.log('   - Tambi√©n verificar Redirect URLs y variables de entorno')
console.log('   - Despu√©s de corregir, esperar 2-3 minutos y probar')
